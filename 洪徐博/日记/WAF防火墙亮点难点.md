# WAF防火墙亮点难点

- ## 难点:

  1. #### 初次使用openresty以及编写lua脚本，面对不熟悉的编写语法以及nginx配置方法，让我难以下手编写防火墙代码

  2. #### 之前未了解过waf防火墙，不知道waf防火墙能做什么防护措施

  3. #### 在linux中配置waf防火墙遇到了文件夹权限不足问题，第一次遇到时一头雾水，不知如何解决，后面通过多次的代码测试得出答案

  4. #### 由于攻击记录需要记录在数据库中供平台管理员查看，需要编写lua脚本连接opengauss数据库并将攻击记录写入数据库，由于openresty并未自带opengauss的postgres连接驱动，还需要手动配置luarocks来安装luapostgres用于连接opengauss

  5. #### 表单提交的数据使用openresty自带的lua库函数无法拿到，还需要自行查找相关资料才能编写出获取form-data数据的函数

- ## 亮点：

  1. #### 使用了openresty和nginx以及redis，opengauss来实现waf防火墙的防护以及攻击日志的写入

  2. #### 自定义拦截过滤函数,有:

     - ##### white_ip_check() --ip白名单检测

     - ##### black_ip_check() --ip黑名单检测

     - ##### sql_injection() --检测sql注入

     - ##### cc_defense() --检测cc攻击
  
     - ##### xss_defense() --检测xss攻击
  
  3. #### 采用ip白名单和黑名单机制，可以用于限制只有内部网络或特定合作伙伴的IP地址访问敏感资源， 以及阻止恶意访问和攻击者，减少服务器性能开销
  
  4. #### 利用sql_injection()函数有效防范get请求以及post请求的json数据以及表单数据sql注入
  
  5. #### 利用cc_defense()函数以及redis数据库实时检测访问者的访问频率，若访问者1分钟访问超过60次，则视为cc攻击并记录在黑名单中，和数据库日志中
  
  6. #### 利用xss_defense()函数检测访问者请求数据是否包含了xss注入，判断为xss攻击则将访问数据及ip记录在数据库和日志中
  
  7. #### 可以将攻击者ip记录在黑名单中，方便管理员查看
  
  8. #### 将攻击日志记录在了opengauss数据库中，方便管理员查看
  
  9. #### 将每条攻击日志以及访问日志都存在了虚拟机中，可以精确查看攻击信息
  
  10. #### waf防火墙为服务器减小了性能负担，有效防止外界攻击
  
- ## 功能测试情况：

  - #### 防止get请求的sql注入(完成)

  - #### 防止post请求的sql注入(完成)

  - #### 防止cc并发攻击并记录日志(完成)

  - #### 防止xss攻击(完成)